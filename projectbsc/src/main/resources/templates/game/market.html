<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<th:block layout:fragment="content">

	<div>
		<h1>거래소</h1><br>
		<span>ㅇㅇㅇ<button onclick="purchase()">구매</button></span><br>
		metadata: <input type="text" id="metadata"><button onclick="addAircraft()">적용</button>
	</div>
	<div>

	</div>


	<script>
		function purchase() {

			let price = 1500 * 1000000000000000000;
			let value = '0x' + price.toString(16);

			const transactionParameters = {
				gas: '0x7530',
				to: '0x80C2272266C86d7d6FA292aB11FE5E5c261955eB',
				from: klaytn.selectedAddress,
				value: value
			}

			klaytn.sendAsync({
					method: 'klay_sendTransaction',
					params: [transactionParameters],
					from: klaytn.selectedAddress
				},
				function (a, b) {
					console.log(a);
					console.log(b);
				}
			)
		}

		function addAircraft() {
			//if(토큰소유자.address == klaytn.selectedAddress)

			let url = document.getElementById('metadata').value;
			fetch(url)
				.then(r => r.json())
				.then(r => {

					let obj = {
						'address': klaytn.selectedAddress,
						'hp': r.attributes[0].value,
						'metadata': url
					}

					fetch('/aircraft', {
						method: 'post',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify(obj)
					})
					.then(r=>console.log(r))
					.catch(err=>console.log(err));

				})
				.catch(err => console.log(err));
		}
	</script>

</th:block>

</html>